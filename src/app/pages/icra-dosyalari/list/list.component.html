<div class="container py-4">

  <!-- YORUM: Başlık alanı (Lacivert) ve Buton (Kırmızı) Halkbank temasına uyarlandı -->
  <div class="d-flex justify-content-between align-items-center pb-2 mb-3" style="border-bottom: 1px solid #dee2e6;">
    <h3 class="m-0" style="color: #003D7C; font-weight: 600;">İcra Dosyaları Yönetimi</h3>
    <a class="btn d-flex align-items-center gap-2" [routerLink]="['/icra-dosyalari/yeni']"
      style="background-color: #E11A24; color: white; border-color: #E11A24; border-radius: 0.375rem; font-weight: 500;">
      <i class="bi bi-plus-lg"></i>
      <span>Yeni İcra Dosyası</span>
    </a>
  </div>

  <!-- YORUM: Arama alanı stil iyileştirmesi -->
  <div class="p-3 mb-3" style="background-color: #f8f9fa; border: 1px solid #dee2e6; border-radius: 0.375rem;">
    <div class="d-flex gap-2">
      <input class="form-control" [(ngModel)]="q" placeholder="Ara (Dosya No, Müşteri, Avukat)" (keyup.enter)="ara()" />
      <button class="btn btn-outline-secondary" type="button" (click)="ara()" style="min-width: 100px;">
        <i class="bi bi-search"></i> Ara
      </button>
      <button class="btn btn-outline-dark" type="button" (click)="temizle()">Temizle</button>
    </div>
  </div>

  <!-- YORUM: Yüklenme göstergesi eklendi -->
  <div *ngIf="loading()" class="text-center py-5">
    <div class="spinner-border" role="status" style="color: #003D7C; width: 3rem; height: 3rem;">
      <span class="visually-hidden">Yükleniyor...</span>
    </div>
    <div class="mt-2" style="color: #003D7C; font-size: 1.1rem;">İcra Dosyaları Yükleniyor...</div>
  </div>

  <!-- YORUM: table-dark kaldırıldı, aydınlık tema ve stil (border) eklendi -->
  <div class="table-responsive" *ngIf="!loading()">
    <table class="table table-hover align-middle" style="border: 1px solid #dee2e6;">
        
        <!-- YORUM: Tablo başlığı (Lacivert) Halkbank temasına uyarlandı -->
        <thead style="background-color: #f8f9fa;">
            <tr>
                <th scope="col" style="color: #003D7C; font-weight: 600; padding: 0.75rem;">#</th>
                <th scope="col" style="color: #003D7C; font-weight: 600; padding: 0.75rem;">Dosya No</th>
                <th scope="col" style="color: #003D7C; font-weight: 600; padding: 0.75rem;">Borçlu (Müşteri)</th>
                <th scope="col" style="color: #003D7C; font-weight: 600; padding: 0.75rem;">Avukat</th>
                <th scope="col" style="color: #003D7C; font-weight: 600; padding: 0.75rem;">Takip Türü</th> <!-- YORUM: YENİ SÜTUN EKLENDİ -->
                <th scope="col" style="color: #003D7C; font-weight: 600; padding: 0.75rem;">Durum</th>
                <th scope="col" class="text-end" style="color: #003D7C; font-weight: 600; padding: 0.75rem; width: 180px;">İşlemler</th>
            </tr>
        </thead>
        
        <tbody>
            <tr *ngFor="let icra of data.items; index as i">
                <td>{{ (page - 1) * pageSize + i + 1 }}</td>
                <td><strong>{{ icra.dosyaNo }}</strong></td>
                <td>{{ icra.musteriAdi }}</td>
                <td>{{ icra.avukatAdiSoyadi || '-' }}</td>
                
                <!-- YORUM: YENİ SÜTUN VERİSİ EKLENDİ (Takip Türü) -->
                <td>
                  <span class="badge" [ngClass]="icra.takipTipi === 'IlamliTakip' ? 'text-bg-info' : 'text-bg-secondary'">
                    <!-- YORUM: Hata düzeltildi. 'null' kontrolü eklendi. -->
                    {{ icra.takipTipi ? takipTipiText[icra.takipTipi] : '-' }}
                  </span>
                </td>

                <td>
                    <!-- YORUM: Durum gösterimi iyileştirildi (renkler eklendi) -->
                    <span 
                      class="badge" 
                      [ngClass]="{
                        'text-bg-success': icra.durum == 1, 
                        'text-bg-warning': icra.durum == 2,
                        'text-bg-primary': icra.durum == 3,
                        'text-bg-dark': icra.durum == 4
                      }">
                      {{ icraDurumuText[icra.durum] || 'Bilinmiyor' }}
                    </span>
                </td>
                <td class="text-end">
                    <!-- YORUM: Butonlar ikonlu ve stilli hale getirildi -->
                    <a class="btn btn-sm btn-outline-secondary me-2" [routerLink]="['/icra-dosyalari/duzenle', icra.id]" title="Düzenle"
                      style="--bs-btn-color: #003D7C; --bs-btn-border-color: #003D7C; --bs-btn-hover-bg: #003D7C; --bs-btn-hover-color: #fff;">
                      <i class="bi bi-pencil-fill"></i>
                      <span class="d-none d-md-inline ms-1">Düzenle</span>
                    </a>

                    <button class="btn btn-sm btn-outline-danger" (click)="sil(icra)" [disabled]="silLoadingId() === icra.id" title="Sil">
                      <i *ngIf="silLoadingId() !== icra.id" class="bi bi-trash-fill"></i>
                      <span *ngIf="silLoadingId() === icra.id" class="spinner-border spinner-border-sm"></span>
                      <span *ngIf="silLoadingId() !== icra.id" class="d-none d-md-inline ms-1">Sil</span>
                    </button>
                </td>
            </tr>
            
            <!-- YORUM: Kayıt yok durumu -->
            <tr *ngIf="data.items.length === 0">
                <td colspan="7" class="text-center text-muted py-4"> <!-- YORUM: colspan 7'ye güncellendi -->
                  Gösterilecek kayıt bulunamadı.
                </td>
            </tr>
        </tbody>
    </table>
  </div>

  <!-- YORUM: Sayfalama alanı -->
  <div class="d-flex justify-content-between align-items-center mt-2" *ngIf="!loading() && data.totalCount > 0">
    <div>
      Toplam: <strong>{{ data.totalCount }}</strong> Kayıt
    </div>
    
    <nav *ngIf="toplamSayfa > 1">
      <ul class="pagination m-0">
        <li class="page-item" [class.disabled]="page === 1">
          <button class="page-link" (click)="yenile(page - 1)">&laquo; Önceki</button>
        </li>
        <li class="page-item disabled">
          <span class="page-link">{{ page }} / {{ toplamSayfa }}</span>
        </li>
        <li class="page-item" [class.disabled]="page >= toplamSayfa">
          <button class="page-link" (click)="yenile(page + 1)">Sonraki &raquo;</button>
        </li>
      </ul>
    </nav>
    
    <div class="d-flex align-items-center gap-2">
      <label class="text-nowrap">Göster:</label>
      <select class="form-select form-select-sm" style="width:auto" [(ngModel)]="pageSize" (change)="yenile(1)">
        <option [ngValue]="10">10</option>
        <option [ngValue]="20">20</option>
        <option [ngValue]="50">50</option>
      </select>
    </div>
  </div>
</div>

