<div class="container py-4" [class.opacity-50]="kaydediliyor()">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="m-0">{{ duzenlemeMi ? 'Avukat Düzenle' : 'Yeni Avukat' }}</h3>
        <a class="btn btn-outline-secondary" [routerLink]="['/avukatlar']">Listeye Dön</a>
    </div>

    <form [formGroup]="frm" (ngSubmit)="onSubmit()" novalidate>
        <div class="row g-3">
            <div class="col-md-4">
                <label class="form-label">Adı <span class="text-danger">*</span></label>
                <input class="form-control" 
                       formControlName="adi"
                       [class.is-invalid]="f.adi.invalid && (f.adi.touched || submitted)" />
                <!-- Hata Mesajları -->
                <div *ngIf="f.adi.invalid && (f.adi.touched || submitted)" class="invalid-feedback">
                    <div *ngIf="f.adi.errors?.['required']">Adı zorunludur.</div>
                    <div *ngIf="f.adi.errors?.['maxlength']">En fazla 100 karakter olabilir.</div>
                </div>
            </div>
            <div class="col-md-4">
                <label class="form-label">Soyadı <span class="text-danger">*</span></label>
                <input class="form-control" 
                       formControlName="soyadi"
                       [class.is-invalid]="f.soyadi.invalid && (f.soyadi.touched || submitted)" />
                <!-- Hata Mesajları -->
                <div *ngIf="f.soyadi.invalid && (f.soyadi.touched || submitted)" class="invalid-feedback">
                    <div *ngIf="f.soyadi.errors?.['required']">Soyadı zorunludur.</div>
                    <div *ngIf="f.soyadi.errors?.['maxlength']">En fazla 100 karakter olabilir.</div>
                </div>
            </div>
            <div class="col-md-4">
                <label class="form-label">TCKN</label>
                <input
                    type="text"
                    maxlength="11"
                    appNumbersOnly
                    class="form-control" 
                    formControlName="tckn" 
                    placeholder="11 haneli TCKN"
                    [class.is-invalid]="f.tckn.invalid && (f.tckn.touched || submitted)" 
                />
                <!-- Hata Mesajları -->
                <div *ngIf="f.tckn.invalid && (f.tckn.touched || submitted)" class="invalid-feedback">
                    <div *ngIf="f.tckn.errors?.['pattern']">TCKN 11 haneli rakam olmalıdır.</div>
                </div>
            </div>
            <div class="col-md-4">
                <label class="form-label">Vergi Dairesi</label>
                <input class="form-control" formControlName="vergiDairesi" />
            </div>
            <div class="col-md-4">
                <label class="form-label">Vergi No</label>
                <input 
                    type="text"
                    appNumbersOnly
                    maxlength="10"
                    class="form-control" 
                    formControlName="vergiNo" 
                    placeholder="10 haneli Vergi No"
                    [class.is-invalid]="f.vergiNo.invalid && (f.vergiNo.touched || submitted)" 
                />
                <!-- Hata Mesajları -->
                <div *ngIf="f.vergiNo.invalid && (f.vergiNo.touched || submitted)" class="invalid-feedback">
                    <div *ngIf="f.vergiNo.errors?.['pattern']">Vergi No 10 haneli rakam olmalıdır.</div>
                </div>
            </div>
            <div class="col-md-4">
                <label class="form-label">Email</label>
                <input type="email" 
                       class="form-control" 
                       formControlName="email"
                       [class.is-invalid]="f.email.invalid && (f.email.touched || submitted)" />
                <!-- Hata Mesajları -->
                <div *ngIf="f.email.invalid && (f.email.touched || submitted)" class="invalid-feedback">
                    <div *ngIf="f.email.errors?.['email']">Geçerli bir e-posta adresi girin.</div>
                    <div *ngIf="f.email.errors?.['maxlength']">En fazla 200 karakter olabilir.</div>
                </div>
            </div>
            <div class="col-md-4">
                <label class="form-label">Cep Telefonu</label>
                <input 
                    type="text"
                    appTelefonMask 
                    maxlength="13" 
                    class="form-control"
                    formControlName="cepTelefonu"
                    placeholder="543-456-48-86" 
                />
            </div>
            <div class="col-md-4">
                <label class="form-label">İş Telefonu</label>
                <input 
                    type="text"
                    appTelefonMask 
                    maxlength="13"
                    class="form-control" 
                    formControlName="isTelefonu" 
                    placeholder="123-456-78-90"
                />
            </div>
            <div class="col-md-4">
                <label class="form-label">İş Faks No</label>
                <input 
                    type="text" 
                    appTelefonMask 
                    maxlength="13"
                    class="form-control" 
                    formControlName="isFaxNo" 
                    placeholder="123-456-78-90"
                />
            </div>
            <div class="col-md-4">
                <label class="form-label">Doğum Tarihi</label>
                <input 
                    type="date" 
                    class="form-control" 
                    formControlName="dogumTarihi"
                    (keydown)="$event.preventDefault()"
                    style="cursor: pointer;"
                />
            </div>

            <h5 class="mt-4">Adres Bilgileri</h5>
            <hr class="mt-0">
            <div class="col-md-4">
                <label class="form-label">Şehir</label>
                <select class="form-select" formControlName="sehirId">
                    <option [ngValue]="null">Seçiniz</option> 
                    <option *ngFor="let s of (sehirler$ | async)" [ngValue]="s.id">{{ s.ad }}</option>
                </select>
            </div>
            <div class="col-md-4">
                <label class="form-label">İlçe</label>
                <select class="form-select" formControlName="ilceId" [disabled]="!frm.controls.sehirId.value">
                    <option [ngValue]="null">Önce Şehir Seçiniz</option> 
                    <option *ngFor="let ilce of (ilceler$ | async)" [ngValue]="ilce.id">{{ ilce.ad }}</option>
                </select>
            </div>
            <div class="col-12">
                <label class="form-label">Tam Adres</label>
                <textarea class="form-control" 
                          formControlName="tamAdres" 
                          rows="3"
                          [class.is-invalid]="f.tamAdres.invalid && (f.tamAdres.touched || submitted)"></textarea>
                <!-- Hata Mesajları -->
                <div *ngIf="f.tamAdres.invalid && (f.tamAdres.touched || submitted)" class="invalid-feedback">
                    <div *ngIf="f.tamAdres.errors?.['maxlength']">En fazla 500 karakter olabilir.</div>
                </div>
            </div>

            <h5 class="mt-4">Hesap Bilgileri</h5>
            <hr class="mt-0">
            <div class="col-md-4">
                <label class="form-label">Avans Hesap Şubesi</label>
                <select class="form-select" formControlName="avansHesapSubeId">
                    <option [ngValue]="null">Seçiniz</option> 
                    <option *ngFor="let s of (subeler$ | async)" [ngValue]="s.brmKod">{{ s.brmAd }}</option>
                </select>
            </div>
            <div class="col-md-4">
                <label class="form-label">Avans Hesap No</label>
                <input class="form-control" formControlName="avansHesapNo" />
            </div>
            <div class="col-md-4">
                <label class="form-label">Vadesiz Hesap Şubesi</label>
                <select class="form-select" formControlName="vadesizHesapSubeId">
                    <option [ngValue]="null">Seçiniz</option> 
                    <option *ngFor="let s of (subeler$ | async)" [ngValue]="s.brmKod">{{ s.brmAd }}</option>
                </select>
            </div>
            <div class="col-md-4">
                <label class="form-label">Vadesiz Hesap No</label>
                <input class="form-control" formControlName="vadesizHesapNo" />
            </div>
            <div class="col-md-4">
                <label class="form-label">Halkbank Vadesiz IBAN</label>
                <input 
                    type="text"
                    maxlength="26" 
                    class="form-control" 
                    formControlName="halkbankVadesizIbanNo" 
                    placeholder="TR000000000000000000000000"
                    [class.is-invalid]="f.halkbankVadesizIbanNo.invalid && (f.halkbankVadesizIbanNo.touched || submitted)"
                />
                <!-- Hata Mesajları -->
                <div *ngIf="f.halkbankVadesizIbanNo.invalid && (f.halkbankVadesizIbanNo.touched || submitted)" class="invalid-feedback">
                    <div *ngIf="f.halkbankVadesizIbanNo.errors?.['pattern']">IBAN 'TR' ile başlamalı ve 24 rakamdan oluşmalıdır (Toplam 26 karakter).</div>
                </div>
            </div>
            <div class="col-md-4">
                <label class="form-label">Diğer Banka IBAN</label>
                <input 
                    type="text"
                    maxlength="26"
                    class="form-control" 
                    formControlName="digerBankaIbanNo" 
                    placeholder="TR000000000000000000000000"
                    [class.is-invalid]="f.digerBankaIbanNo.invalid && (f.digerBankaIbanNo.touched || submitted)"
                />
                 <!-- Hata Mesajları -->
                 <div *ngIf="f.digerBankaIbanNo.invalid && (f.digerBankaIbanNo.touched || submitted)" class="invalid-feedback">
                    <div *ngIf="f.digerBankaIbanNo.errors?.['pattern']">IBAN 'TR' ile başlamalı ve 24 rakamdan oluşmalıdır (Toplam 26 karakter).</div>
                </div>
            </div>

            <h5 class="mt-4">Diğer Bilgiler</h5>
            <hr class="mt-0">
            <div class="col-md-4">
                <label class="form-label">Avans Limiti <span class="text-danger">*</span></label>
                <input type="number" 
                       class="form-control" 
                       formControlName="avansLimiti"
                       [class.is-invalid]="f.avansLimiti.invalid && (f.avansLimiti.touched || submitted)" />
                <!-- Hata Mesajları -->
                <div *ngIf="f.avansLimiti.invalid && (f.avansLimiti.touched || submitted)" class="invalid-feedback">
                    <div *ngIf="f.avansLimiti.errors?.['required']">Avans Limiti zorunludur.</div>
                    <div *ngIf="f.avansLimiti.errors?.['min']">Değer 0'dan küçük olamaz.</div>
                </div>
            </div>
           <div class="col-md-4">
            <label class="form-label">Avukat Tipi</label>
            <select class="form-select" formControlName="avukatTipi">
                    <option [ngValue]="null">Seçiniz</option> 
                    <option *ngFor="let tipi of avukatTipleri" [value]="tipi[0]">
                        {{ tipi[1] }}
                    </option>
                </select>
            </div>
            <div class="col-12 d-flex flex-wrap gap-3 mt-3">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" formControlName="hesapAktifMi">
                    <label class="form-check-label">Hesap Aktif Mi?</label>
                </div>
            </div>
        </div>

        <div class="mt-4 d-flex gap-2">
            <button class="btn btn-primary" type="submit" [disabled]="kaydediliyor()">
                {{ kaydediliyor() ? 'Kaydediliyor...' : (duzenlemeMi ? 'Güncelle' : 'Kaydet') }}
            </button>
            <a class="btn btn-outline-secondary" [routerLink]="['/avukatlar']" [class.disabled]="kaydediliyor()">İptal</a>
        </div>
    </form>
</div>

